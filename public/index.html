<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ramona Remote</title>
    <link rel="icon" type="image/x-icon" href="/favicon.svg">
    <style>
      /*Definetly didnt "borrow" some of the slider styling from W3*/
      .slider {
        -webkit-appearance: none;
        appearance: none;
        width: 100%;
        height: 15px;
        border-radius: 5px;  
        background: #d3d3d3;
        outline: none;
        -webkit-transition: .2s;
        margin-top: 10px;
        transition: cubic-bezier(0.075, 0.82, 0.165, 1) 0.2s;
      }
      .slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 25px;
        height: 25px;
        border-radius: 50%; 
        background: #20CC4B;
        cursor: pointer;
      }
      .slider::-moz-range-thumb {
        width: 25px;
        height: 25px;
        border-radius: 50%;
        background: #20CC4B;
        cursor: pointer;
      }
    </style>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&family=Raleway:ital,wght@0,100..900;1,100..900&display=swap');
      body {
        background-color: rgb(36, 38, 46);
        color: white;
      }
      h1 {
        font-family: 'Raleway';
        font-size: 40px;
        font-weight: 500;
        margin: 0px;
      }
      h2 {
        margin: 0px;
        font-weight: 300;
        margin-right: 10px;
      }
      .btnCtrl {
        display: flex;
        align-items: center;
        margin: 10px 0px;
        font-family: 'Montserrat';
      }
      .ctrlBtn {
        border: none;
        border-radius: 5px;
        background-color: #20CC4B;
        color: white;
        padding: 10px;
        cursor: pointer;
        transition: cubic-bezier(0.075, 0.82, 0.165, 1) 0.2s;
        font-weight: 400;
      }
      .ctrlBtn:active {
        background-color: #148631;
      }
      .slideCtrl {
        display: flex;
        flex-direction: column;
        margin: 10px 0px;
        font-family: 'Montserrat';
      }
      .slideSplit {
        display: flex;
        justify-content: space-between;
      }
      .slideValue {
        font-family: 'Montserrat';
      }
    </style>
  </head>
  <body>
    <svg xmlns="http://www.w3.org/2000/svg" width="230" height="48" fill="none" viewBox="0 0 230 48"><g clip-path="url(#a)"><path fill="#20CC4B" d="M34.639 47.332H1.243A1.243 1.243 0 0 1 0 46.089V12.693A12.71 12.71 0 0 1 12.694 0H46.09a1.243 1.243 0 0 1 1.242 1.242v33.396A12.71 12.71 0 0 1 34.64 47.333M2.477 44.847h32.162A10.217 10.217 0 0 0 44.847 34.64V2.484H12.663A10.224 10.224 0 0 0 2.446 12.693zM32.37 24.245a7.95 7.95 0 0 0-7.948 7.947 7.948 7.948 0 0 0 13.562 5.615 7.94 7.94 0 0 0 .001-11.232 7.95 7.95 0 0 0-5.615-2.33m0 13.604a5.664 5.664 0 0 1-5.664-5.657 5.663 5.663 0 0 1 5.664-5.663 5.664 5.664 0 0 1 5.656 5.663 5.663 5.663 0 0 1-5.656 5.657M16.938 23.697v-.062a1.14 1.14 0 0 1 .771-1.073 8.05 8.05 0 0 0 5.324-7.785 8.087 8.087 0 0 0-7.716-7.832 8.049 8.049 0 0 0-3.056 15.61 1.16 1.16 0 0 1 .772 1.08v.062a1.14 1.14 0 0 1-.772 1.072 8.07 8.07 0 0 0-5.324 7.786 8.094 8.094 0 0 0 7.716 7.832 8.048 8.048 0 0 0 3.056-15.61 1.16 1.16 0 0 1-.749-1.057zm6.736-10.687h-.062a1.13 1.13 0 0 1-1.073-.772 8.055 8.055 0 0 0-7.785-5.316 8.08 8.08 0 0 0-7.832 7.716 8.049 8.049 0 0 0 15.61 3.048 1.15 1.15 0 0 1 1.08-.772h.062a1.14 1.14 0 0 1 1.073.772 8.05 8.05 0 0 0 7.785 5.316 8.086 8.086 0 0 0 7.832-7.716 8.056 8.056 0 0 0-8.04-8.364 8.05 8.05 0 0 0-7.57 5.308 1.16 1.16 0 0 1-1.057.78zm-6.736 10.687v-.062a1.14 1.14 0 0 1 .771-1.073 8.05 8.05 0 0 0 5.324-7.785 8.087 8.087 0 0 0-7.716-7.832 8.049 8.049 0 0 0-3.056 15.61 1.16 1.16 0 0 1 .772 1.08v.062a1.14 1.14 0 0 1-.772 1.072 8.07 8.07 0 0 0-5.324 7.786 8.094 8.094 0 0 0 7.716 7.832 8.048 8.048 0 0 0 3.056-15.61 1.16 1.16 0 0 1-.749-1.057zm6.736-10.687h-.062a1.13 1.13 0 0 1-1.073-.772 8.055 8.055 0 0 0-7.785-5.316 8.08 8.08 0 0 0-7.832 7.716 8.049 8.049 0 0 0 15.61 3.048 1.15 1.15 0 0 1 1.08-.772h.062a1.14 1.14 0 0 1 1.073.772 8.05 8.05 0 0 0 7.785 5.316 8.086 8.086 0 0 0 7.832-7.716 8.056 8.056 0 0 0-8.04-8.364 8.05 8.05 0 0 0-7.57 5.308 1.16 1.16 0 0 1-1.057.78z"></path><path fill="#f4fbff" d="M71.723 17.485c.777-.42 1.604-.742 2.461-.956a13.1 13.1 0 0 1 3.434-.402q.686.003 1.366.085c.448.054.818.116 1.103.17a2 2 0 0 0 .34-.618c.084-.248.126-.509.123-.771 0-1.127-1.134-1.698-3.395-1.698-1.44-.019-2.876.16-4.267.533a11 11 0 0 0-2.994 1.25c-.48.285-.892.67-1.211 1.126a2.9 2.9 0 0 0-.363 1.544v14.398q0 1.544 1.829 1.544a4 4 0 0 0 .933-.108 4.5 4.5 0 0 0 .64-.193zM104.433 14.939a9.4 9.4 0 0 0-5.857-1.651c-1.086-.01-2.17.095-3.233.316a10.4 10.4 0 0 0-2.631.91 3 3 0 0 0-.934.726 1.54 1.54 0 0 0-.294.972c-.005.305.09.603.27.849q.273.376.618.687a18 18 0 0 1 2.801-1.15 10.8 10.8 0 0 1 3.356-.51 5.54 5.54 0 0 1 3.442.973 3.673 3.673 0 0 1 1.273 3.087v1.188l-6.034.594a9.9 9.9 0 0 0-5.131 1.767 5.02 5.02 0 0 0-1.83 4.22 5.24 5.24 0 0 0 2.185 4.545q2.19 1.544 6.173 1.544c1.3.02 2.597-.13 3.858-.448a10.7 10.7 0 0 0 2.7-1.041 3.5 3.5 0 0 0 1.081-.911c.267-.423.394-.92.363-1.42v-10.03q-.009-3.558-2.176-5.217m-1.189 15.247a7 7 0 0 1-1.674.703c-.962.264-1.958.386-2.955.362a6.5 6.5 0 0 1-3.736-.872 2.86 2.86 0 0 1-1.234-2.484 2.7 2.7 0 0 1 1.065-2.315 6.56 6.56 0 0 1 3.272-.996l5.262-.555zM142.868 20.117v12.022q0 1.542 1.828 1.543.462-.002.911-.108.336-.068.656-.193V19.962c0-2.26-.68-3.943-2.038-5.03a8.5 8.5 0 0 0-5.478-1.637c-1.29-.02-2.573.203-3.781.656a9.3 9.3 0 0 0-2.755 1.636 5.7 5.7 0 0 0-2.461-1.674 10.4 10.4 0 0 0-3.696-.618 12.2 12.2 0 0 0-3.55.533c-1.02.288-1.998.708-2.909 1.25a4.2 4.2 0 0 0-1.25 1.173 2.63 2.63 0 0 0-.363 1.42v14.483q0 1.543 1.829 1.543c.314.002.628-.035.934-.108q.323-.072.632-.193v-15.88a10 10 0 0 1 2.061-.98 7.9 7.9 0 0 1 2.569-.424 4.93 4.93 0 0 1 3.225.98 3.72 3.72 0 0 1 1.197 3.086V32.2c0 1.019.601 1.543 1.821 1.543q.465 0 .918-.108.335-.07.656-.192V19.862a6.3 6.3 0 0 0-.255-1.821 7.14 7.14 0 0 1 4.923-1.96 4.88 4.88 0 0 1 3.187.98 3.71 3.71 0 0 1 1.189 3.055M200.068 20.672v11.466q0 1.544 1.829 1.544.462-.003.911-.108.336-.069.655-.193V20.518q0-3.742-2.23-5.479c-1.481-1.165-3.518-1.744-6.088-1.744a14.2 14.2 0 0 0-4.12.556 12.6 12.6 0 0 0-2.932 1.227 3.85 3.85 0 0 0-1.25 1.126 2.73 2.73 0 0 0-.363 1.466v14.484q0 1.543 1.829 1.543c.314.002.628-.035.933-.108q.324-.072.633-.193v-15.88a11.2 11.2 0 0 1 2.253-.98 10 10 0 0 1 3.017-.424 5.5 5.5 0 0 1 3.588 1.103 4.28 4.28 0 0 1 1.335 3.457M227.84 14.939a9.44 9.44 0 0 0-5.865-1.652 15 15 0 0 0-3.225.317c-.914.183-1.8.49-2.632.91a2.9 2.9 0 0 0-.933.726c-.208.28-.314.623-.301.972-.003.306.095.604.278.849q.269.379.617.687a17.6 17.6 0 0 1 2.801-1.15 10.8 10.8 0 0 1 3.356-.51 5.56 5.56 0 0 1 3.442.973 3.673 3.673 0 0 1 1.273 3.087v1.188l-6.034.594a9.95 9.95 0 0 0-5.139 1.767 5.02 5.02 0 0 0-1.821 4.22 5.23 5.23 0 0 0 2.184 4.545q2.183 1.544 6.173 1.544c1.3.02 2.597-.13 3.858-.448a10.7 10.7 0 0 0 2.693-1.041c.42-.228.79-.538 1.088-.911.264-.424.388-.921.355-1.42v-10.03q-.008-3.558-2.168-5.217m-1.189 15.247a7 7 0 0 1-1.682.703c-.96.264-1.953.386-2.948.362a6.54 6.54 0 0 1-3.742-.872 2.87 2.87 0 0 1-1.227-2.485 2.7 2.7 0 0 1 1.057-2.314 6.6 6.6 0 0 1 3.272-.996l5.27-.555zM166.371 13.442a10.187 10.187 0 0 0-9.419 14.087 10.18 10.18 0 0 0 9.419 6.292 10.183 10.183 0 0 0 10.186-10.194 10.183 10.183 0 0 0-10.186-10.185m0 17.03a6.85 6.85 0 0 1-6.844-6.845 6.845 6.845 0 0 1 6.844-6.836 6.837 6.837 0 0 1 4.835 11.673 6.85 6.85 0 0 1-4.835 2.008" class="name"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h230v47.332H0z"></path></clipPath></defs></svg>
    <br>
    <div style="display: flex; align-items: flex-start;">
      <div style="display: flex; text-align: left; flex-direction: column; background-color: black; border-radius: 50px 0px 0px 10px; width: 400px; padding-left: 20px; padding-top: 10px; padding-right: 10px; height: calc((100vw - 446px) * 9/16 - 10px); overflow-y: scroll;">
        <h1>Controls</h1>
        <div class="btnCtrl" style="margin-top: 40px;">
          <h2>examplectrl</h2>
          <h2 class="ctrlBtn" onclick="sendData('good job, you can press a button')">dothis</h2>
        </div>
        <div class="btnCtrl">
          <h2 class="ctrlBtn" onclick="sendData('bet you didnt see this one coming')">I can also just use a button</h2>
        </div>
        <div class="slideCtrl">
          <div class="slideSplit">
            <h2>it slides</h2>
            <h2 class="slideValue">--</h2>
          </div>
          <input type="range" min="1" max="100" value="50" class="slider" message="slider set to ">
        </div>
        <div class="slideCtrl">
          <div class="slideSplit">
            <h2>reactor temperature</h2>
            <h2 class="slideValue">--</h2>
          </div>
          <input type="range" min="1" max="100" value="20" class="slider" message="reactor temp set to ">
        </div>
        <div class="btnCtrl">
          <h2 class="ctrlBtn" onclick="sendData('Wow its another button | NUKE LAUNCHED')">Launch the nuke</h2>
        </div>
        <p onclick="sendData('DATA')">DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA DATA</p>
      </div>
      <video id="video" style="border-radius: 0px 10px 50px 0px; width: calc(100vw - 446px);" autoplay muted playsinline></video>
    </div>

    <script src="https://cdn.socket.io/4.3.2/socket.io.min.js"></script>

    <script>
      const socket = io.connect('http://localhost:3000');
      const video = document.getElementById('video');
      const messageInput = document.getElementById('messageInput');
      const sendMessageButton = document.getElementById('sendMessage');
      const sliderElements = [Array.from(document.getElementsByClassName("slider")), Array.from(document.getElementsByClassName("slideValue"))]
      sliderElements[0].forEach((element, index) => {element.oninput = function() {sliderElements[1][index].innerHTML = this.value; sendData(this.getAttribute("message") + this.value);}});
      sliderElements[1].forEach((element, index) => {element.innerHTML = sliderElements[0][index].value});

      const mediaSource = new MediaSource();
      video.src = URL.createObjectURL(mediaSource);

      mediaSource.addEventListener('sourceopen', () => {
        const sourceBuffer = mediaSource.addSourceBuffer('video/webm; codecs="vp9, vorbis"');
        const queue = [];
        let isAppending = false;

        const processQueue = () => {
          if (queue.length > 0 && !isAppending) {
            isAppending = true;
            const chunk = queue.shift();
            sourceBuffer.appendBuffer(chunk);
          }
        };

        sourceBuffer.addEventListener('updateend', () => {
          isAppending = false;
          processQueue();
        });

        socket.on('video-stream', (data) => {
          queue.push(new Uint8Array(data));
          processQueue();
        });
      });

      function sendData(data) {
        socket.emit('data-message', data);
      }

      let throttleTimeout;

      video.addEventListener("wheel", function(e) {
        if (!throttleTimeout) {
          throttleTimeout = setTimeout(() => {
            const bounds = e.target.getBoundingClientRect();
            const location = [e.clientX - bounds.left, e.clientY - bounds.top];
            if (e.deltaY > 0) {
              sendData("scroll zoom out | Location: " + location);
            } else {
              sendData("scroll zoom in | Location: " + location);
            }
            throttleTimeout = null;
          }, 200);
        }
      });

      let isDragging = false;
      let prevLocation = [0,0]
      video.addEventListener("mousedown", (event) => {
        const bounds = event.target.getBoundingClientRect();
        isDragging = true;
        prevLocation = [event.clientX - bounds.left, event.clientY - bounds.top]
      });

      video.addEventListener("mousemove", (event) => {
        const bounds = event.target.getBoundingClientRect();
        const location = [event.clientX - bounds.left, event.clientY - bounds.top];
        const valChange = [Math.abs(parseInt(location[0]) - parseInt(prevLocation[0])), Math.abs(parseInt(location[1]) - parseInt(prevLocation[1]))]
        if (isDragging && (valChange[0] > 2 || valChange[1] > 2)) {
          sendData("pan/drag | Location: " + location);
          prevLocation = location;
        }
        console.log("pan/drag | Location: " + Math.abs(parseInt(location[0]) - parseInt(prevLocation[0])));
      });

      document.addEventListener("mouseup", () => {
        isDragging = false;
      });

      sendData("{clientData-resolution=" + (video.getBoundingClientRect().width * window.devicePixelRatio) + "}")
    </script>
  </body>
</html>
